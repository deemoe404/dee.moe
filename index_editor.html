<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Markdown Editor - NanoSite</title>
  <script src="assets/js/theme-boot.js"></script>
  <script>
    // Early boot to avoid initial flash
    (function () {
      try {
        var initMode = 'composer';
        var rawState = localStorage.getItem('ns_composer_editor_state');
        if (rawState) {
          try {
            var parsed = JSON.parse(rawState);
            if (parsed && typeof parsed === 'object') {
              if (parsed.mode === 'editor' || parsed.mode === 'dynamic') initMode = 'editor';
            }
          } catch (_) {}
        }
        if (initMode === 'composer') document.documentElement.setAttribute('data-init-mode', 'composer');
        else document.documentElement.removeAttribute('data-init-mode');
        // Preselect composer file (index/tabs) when persisted
        var cf = (localStorage.getItem('ns_composer_file') || 'index').toLowerCase();
        if (cf === 'tabs' || cf === 'site') document.documentElement.setAttribute('data-init-cfile', cf);
        else document.documentElement.removeAttribute('data-init-cfile');
      } catch (_) { /* ignore */ }
    })();
  </script>
  <link rel="stylesheet" href="assets/styles.css">
  <link rel="stylesheet" id="theme-pack">
  <style>
    *, *::before, *::after { box-sizing: border-box; }
    html { height: 100%; }
    :root {
      --composer-inline-ease: cubic-bezier(0.16, 1, 0.3, 1);
      --composer-inline-duration-in: 480ms;
      --composer-inline-duration-out: 380ms;
      --editor-toolbar-offset: 0px;
    }
    @media (prefers-reduced-motion: reduce) {
      :root {
        --composer-inline-duration-in: 240ms;
        --composer-inline-duration-out: 200ms;
        --composer-inline-ease: linear;
      }
      .composer-panels { transition: none; }
    }
    /* Widen the editor page and reduce side padding */
    body { margin: 0; min-height: 100vh; display: flex; flex-direction: column; }
    .editor-page { display: block; flex: 1 0 auto; padding: 0.75rem 1rem; max-width: min(95vw, 1200px); width: 100%; margin: 0 auto; }
    /* Editor layout */
    .editor-layout { display: grid; grid-template-columns: minmax(0, 1fr); gap: 1rem; align-items: start; }
    .editor-layout.is-dynamic { grid-template-columns: minmax(0, 1fr); }
    .editor-layout.is-empty { grid-template-columns: minmax(0, 1fr); align-items: center; justify-items: center; }
    .updates-layout { display:flex; flex-direction:column; gap:1rem; }
    .updates-main { display:flex; flex-direction:column; gap:1.25rem; }
    .updates-header { display:flex; flex-wrap:wrap; align-items:flex-start; justify-content:space-between; gap:1rem; }
    .updates-header-text { display:flex; flex-direction:column; gap:.4rem; min-width:0; }
    .updates-title { margin:0; font-size:1.35rem; color: color-mix(in srgb, var(--text) 92%, transparent); }
    .updates-meta { display:flex; flex-direction:column; gap:.15rem; font-size:.92rem; color: color-mix(in srgb, var(--muted) 80%, transparent); }
    .updates-meta span { line-height:1.4; }
    .updates-header-actions { display:flex; align-items:center; gap:.75rem; flex-wrap:wrap; }
    #btnSystemSelect[data-state="busy"] { pointer-events:none; opacity:.82; }
    #btnSystemSelect[data-state="busy"]::after { content:''; display:inline-block; width:1rem; height:1rem; margin-left:.5rem; border:2px solid color-mix(in srgb, var(--primary) 40%, transparent); border-top-color: color-mix(in srgb, var(--primary) 86%, transparent); border-radius:50%; animation: ns-updates-spin .85s linear infinite; vertical-align:middle; }
    .updates-download[aria-disabled="true"] { pointer-events:none; opacity:.55; }
    @keyframes ns-updates-spin { to { transform: rotate(360deg); } }
    .updates-status { margin:0; font-size:.95rem; color: color-mix(in srgb, var(--muted) 82%, transparent); }
    .updates-status[data-tone="warn"] { color: #b45309; }
    .updates-status[data-tone="error"] { color: #dc2626; }
    .updates-status[data-tone="success"] { color: #15803d; }
    .updates-files { display:flex; flex-direction:column; gap:.6rem; }
    .updates-files[hidden] { display:none !important; }
    .updates-subtitle { margin:0; font-size:1.05rem; color: color-mix(in srgb, var(--text) 90%, transparent); }
    .updates-file-list { list-style:none; margin:0; padding:0; display:flex; flex-direction:column; gap:.5rem; }
    .updates-file-item { display:flex; align-items:center; justify-content:space-between; gap:.75rem; padding:.55rem .75rem; border:1px solid color-mix(in srgb, var(--border) 82%, transparent); border-radius:12px; background: color-mix(in srgb, var(--card) 96%, transparent); }
    .updates-file-name { flex:1 1 auto; min-width:0; font-size:.95rem; color: color-mix(in srgb, var(--text) 90%, transparent); overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
    .updates-file-badge { flex:0 0 auto; font-size:.75rem; font-weight:700; text-transform:uppercase; letter-spacing:.04em; color: color-mix(in srgb, var(--primary) 90%, transparent); background: color-mix(in srgb, var(--primary) 14%, transparent); border-radius:999px; padding:.2rem .65rem; }
    .updates-notes { display:flex; flex-direction:column; gap:.55rem; }
    .updates-release-notes { border:1px solid color-mix(in srgb, var(--border) 80%, transparent); border-radius:14px; background: color-mix(in srgb, var(--card) 95%, transparent); padding:1rem 1.1rem; max-height:360px; overflow:auto; font-size:.95rem; color: color-mix(in srgb, var(--text) 88%, transparent); }
    #systemUpdateReleaseNotes { max-height:none; overflow:visible; }
    .updates-release-notes h1,
    .updates-release-notes h2,
    .updates-release-notes h3,
    .updates-release-notes h4 { margin:1rem 0 .5rem; font-size:1.05rem; }
    .updates-release-notes p { margin:.6rem 0; }
    .updates-release-notes ul,
    .updates-release-notes ol { margin:.6rem 0 .6rem 1.2rem; padding:0; }
    .updates-release-notes code { background: color-mix(in srgb, var(--border) 60%, transparent); padding:.15rem .4rem; border-radius:6px; font-size:.85rem; }
    @media (max-width: 900px) {
      .editor-layout { grid-template-columns: 1fr; }
    }
    .editor-layout.is-empty .editor-main { display: none; }
    .editor-empty-state { display: none; grid-column: 1 / -1; align-self: center; justify-self: center; align-items: center; justify-content: center; text-align: center; padding: clamp(1.75rem, 2vw + 1.2rem, 2.25rem) clamp(1.5rem, 2.8vw + 1rem, 2.75rem); border-radius: 14px; border: 1px dashed color-mix(in srgb, var(--border) 80%, transparent); background: color-mix(in srgb, var(--card) 96%, transparent); color: var(--muted); width: min(100%, 520px); box-shadow: 0 20px 36px rgba(15, 23, 42, 0.08); margin-top: clamp(1.5rem, 3vw + 0.5rem, 2.75rem); }
    .editor-layout.is-empty .editor-empty-state { display: flex; }
    .editor-empty-state .empty-body { display: flex; flex-direction: column; gap: .85rem; align-items: center; justify-content: center; }
    .editor-empty-state h2 { margin: 0; font-size: 1.4rem; font-weight: 700; color: var(--text); }
    .editor-empty-state p { margin: 0; font-size: 1rem; line-height: 1.6; }
    @media (max-width: 600px) {
      .editor-empty-state { padding: clamp(1.5rem, 6vw + .75rem, 1.9rem) clamp(1.25rem, 5vw + .85rem, 2.1rem); width: min(100%, 460px); }
      .editor-empty-state h2 { font-size: 1.25rem; }
      .editor-empty-state p { font-size: .95rem; }
    }
    /* Top mode switch (Editor / Composer): bigger, nav-like */
    .mode-switch {
      display: inline-flex;
      gap: .25rem;
      align-items: center;
      flex-wrap: wrap;
      row-gap: .25rem;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: .25rem;
      box-shadow: var(--shadow);
      min-width: 0;
    }
    .mode-tab {
      appearance: none;
      border: 1px solid transparent;
      background: transparent;
      color: var(--muted);
      border-radius: 10px;
      padding: .5rem 1rem;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      line-height: 1.2;
      transition: background-color .18s ease, color .18s ease, border-color .18s ease;
      position: relative;
      overflow: visible;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: .35rem;
      text-align: center;
    }
    .mode-tab:hover { background: color-mix(in srgb, var(--text) 5%, transparent); color: var(--text); }
    .mode-tab.is-active {
      background: color-mix(in srgb, var(--primary) 14%, var(--card));
      border-color: color-mix(in srgb, var(--primary) 38%, var(--border));
      color: var(--primary);
      cursor: default;
    }
    .mode-tab.dynamic-mode {
      position: relative;
      display: inline-flex;
      align-items: center;
      gap: .55rem;
      border-radius: 999px;
      border: 1px solid color-mix(in srgb, var(--border) 70%, transparent);
      padding: .35rem .65rem .35rem .85rem;
      background: linear-gradient(135deg, color-mix(in srgb, var(--card) 88%, var(--primary) 12%), color-mix(in srgb, var(--card) 96%, transparent));
      box-shadow: 0 2px 6px rgba(15, 23, 42, 0.08);
      color: color-mix(in srgb, var(--text) 65%, transparent);
      transition: transform .18s ease, box-shadow .18s ease, border-color .18s ease, background .18s ease, color .18s ease;
      max-width: 240px;
      white-space: nowrap;
      overflow-x: hidden;
      overflow-y: visible;
      text-overflow: ellipsis;
      font-weight: 600;
      cursor: pointer;
    }
    .mode-tab.is-busy {
      opacity: .6;
      cursor: progress;
    }
    .mode-tab.dynamic-mode:hover:not(.is-busy) {
      transform: translateY(-1px);
      box-shadow: 0 12px 24px rgba(15, 23, 42, 0.12);
      color: color-mix(in srgb, var(--text) 85%, transparent);
    }
    .mode-tab.dynamic-mode.is-active {
      border-color: color-mix(in srgb, var(--primary) 50%, var(--border));
      background: linear-gradient(135deg, color-mix(in srgb, var(--primary) 24%, var(--card)), color-mix(in srgb, var(--card) 94%, transparent));
      color: var(--primary);
      box-shadow: 0 14px 32px rgba(9, 105, 218, 0.2);
    }
    .mode-tab.dynamic-mode[data-file-state="checking"] {
      border-color: color-mix(in srgb, #3b82f6 45%, var(--border));
      box-shadow: 0 10px 24px rgba(59, 130, 246, 0.22);
    }
    .mode-tab.dynamic-mode[data-file-state="checking"]:not(.is-active) {
      color: color-mix(in srgb, var(--text) 78%, #2563eb 25%);
    }
    .mode-tab.dynamic-mode[data-file-state="existing"] {
      border-color: color-mix(in srgb, #16a34a 48%, var(--border));
      box-shadow: 0 12px 26px rgba(22, 163, 74, 0.24);
    }
    .mode-tab.dynamic-mode[data-file-state="existing"]:not(.is-active) {
      color: color-mix(in srgb, var(--text) 78%, #15803d 28%);
    }
    .mode-tab.dynamic-mode[data-file-state="missing"] {
      border-color: color-mix(in srgb, #f59e0b 54%, var(--border));
      box-shadow: 0 12px 26px rgba(245, 158, 11, 0.28);
    }
    .mode-tab.dynamic-mode[data-file-state="missing"]:not(.is-active) {
      color: color-mix(in srgb, var(--text) 78%, #d97706 28%);
    }
    .mode-tab.dynamic-mode[data-file-state="error"] {
      border-color: color-mix(in srgb, #ef4444 58%, var(--border));
      box-shadow: 0 12px 26px rgba(239, 68, 68, 0.28);
    }
    .mode-tab.dynamic-mode[data-file-state="error"]:not(.is-active) {
      color: color-mix(in srgb, var(--text) 78%, #dc2626 28%);
    }
    .mode-tab.dynamic-mode[data-file-state="checking"].is-active {
      background: linear-gradient(135deg, color-mix(in srgb, #3b82f6 22%, var(--card)), color-mix(in srgb, var(--card) 94%, transparent));
      color: color-mix(in srgb, #1d4ed8 82%, #2563eb 40%);
      box-shadow: 0 16px 34px rgba(59, 130, 246, 0.28);
    }
    .mode-tab.dynamic-mode[data-file-state="existing"].is-active {
      background: linear-gradient(135deg, color-mix(in srgb, #16a34a 26%, var(--card)), color-mix(in srgb, var(--card) 94%, transparent));
      color: color-mix(in srgb, #14532d 82%, #16a34a 45%);
      box-shadow: 0 16px 34px rgba(22, 163, 74, 0.3);
    }
    .mode-tab.dynamic-mode[data-file-state="missing"].is-active {
      background: linear-gradient(135deg, color-mix(in srgb, #f59e0b 28%, var(--card)), color-mix(in srgb, var(--card) 92%, transparent));
      color: color-mix(in srgb, #92400e 82%, #f97316 45%);
      box-shadow: 0 16px 34px rgba(245, 158, 11, 0.32);
    }
    .mode-tab.dynamic-mode[data-file-state="error"].is-active {
      background: linear-gradient(135deg, color-mix(in srgb, #ef4444 28%, var(--card)), color-mix(in srgb, var(--card) 90%, transparent));
      color: color-mix(in srgb, #991b1b 82%, #ef4444 45%);
      box-shadow: 0 16px 34px rgba(239, 68, 68, 0.32);
    }
    .mode-switch-editor .mode-tab.dynamic-mode {
      box-shadow: none;
    }
    .mode-switch-editor .mode-tab.dynamic-mode:hover:not(.is-busy),
    .mode-switch-editor .mode-tab.dynamic-mode:focus-visible {
      box-shadow: none;
    }
    .mode-switch-editor .mode-tab.dynamic-mode.is-active {
      box-shadow: none;
    }
    .mode-switch-editor .mode-tab.dynamic-mode[data-file-state="checking"] {
      box-shadow: none;
    }
    .mode-switch-editor .mode-tab.dynamic-mode[data-file-state="existing"] {
      box-shadow: none;
    }
    .mode-switch-editor .mode-tab.dynamic-mode[data-file-state="missing"] {
      box-shadow: none;
    }
    .mode-switch-editor .mode-tab.dynamic-mode[data-file-state="error"] {
      box-shadow: none;
    }
    .mode-switch-editor .mode-tab.dynamic-mode[data-file-state="checking"].is-active {
      box-shadow: none;
    }
    .mode-switch-editor .mode-tab.dynamic-mode[data-file-state="existing"].is-active {
      box-shadow: none;
    }
    .mode-switch-editor .mode-tab.dynamic-mode[data-file-state="missing"].is-active {
      box-shadow: none;
    }
    .mode-switch-editor .mode-tab.dynamic-mode[data-file-state="error"].is-active {
      box-shadow: none;
    }
    .mode-tab-badge {
      position: absolute;
      top: -.35rem;
      right: -.35rem;
      min-width: 1.25rem;
      height: 1.25rem;
      padding: 0 .35rem;
      border-radius: 999px;
      background: #ef4444;
      color: #fff;
      font-size: .7rem;
      font-weight: 700;
      line-height: 1;
      letter-spacing: .01em;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 8px rgba(15, 23, 42, 0.22), 0 0 0 2px var(--card);
      transform: scale(.6);
      opacity: 0;
      transition: opacity .18s ease, transform .18s ease;
      pointer-events: none;
      z-index: 2;
      font-feature-settings: 'tnum' 1, 'case' 1;
    }
    .mode-tab-badge[hidden] { display: none; }
    .mode-tab[data-dirty] .mode-tab-badge {
      opacity: 1;
      transform: scale(1);
    }
    .mode-tab.dynamic-mode::before {
      content: '';
      width: .55rem;
      height: .55rem;
      border-radius: 999px;
      background: color-mix(in srgb, var(--muted) 45%, transparent);
      box-shadow: 0 0 0 3px color-mix(in srgb, var(--muted) 12%, transparent);
      opacity: 0;
      transform: scale(.6);
      transition: opacity .18s ease, transform .18s ease, box-shadow .18s ease, background-color .18s ease;
      flex: 0 0 auto;
    }
    .mode-tab.dynamic-mode[data-dirty="1"]::before {
      opacity: 1;
      transform: scale(1);
      background: #f97316;
      box-shadow: 0 0 0 3px color-mix(in srgb, #f97316 22%, transparent);
    }
    .mode-tab.dynamic-mode[data-draft-state="saved"]:not([data-dirty])::before {
      opacity: .95;
      transform: scale(.95);
      background: #22c55e;
      box-shadow: 0 0 0 3px color-mix(in srgb, #22c55e 20%, transparent);
    }
    .mode-tab.dynamic-mode[data-draft-state="conflict"]::before {
      opacity: 1;
      transform: scale(1);
      background: #ef4444;
      box-shadow: 0 0 0 3px color-mix(in srgb, #ef4444 25%, transparent);
    }
    .mode-tab.dynamic-mode.is-busy {
      pointer-events: none;
    }
    .mode-tab-chip { display: inline-flex; align-items: center; gap: .45rem; }
    .mode-tab-label { overflow: hidden; text-overflow: ellipsis; }
    .mode-tab-close {
      appearance: none;
      border: 0;
      background: color-mix(in srgb, var(--card) 70%, transparent);
      color: color-mix(in srgb, var(--text) 50%, transparent);
      border-radius: 999px;
      width: 1.45rem;
      height: 1.45rem;
      font-size: 1rem;
      line-height: 1;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: background-color .18s ease, color .18s ease, opacity .18s ease, transform .18s ease;
      opacity: .5;
    }
    .mode-tab-close:hover {
      background: color-mix(in srgb, var(--text) 14%, transparent);
      color: var(--text);
      opacity: 1;
      transform: scale(1.05);
    }
    .mode-tab-close:focus-visible {
      outline: 2px solid color-mix(in srgb, var(--primary) 45%, transparent);
      outline-offset: 2px;
      opacity: 1;
    }
    .mode-tab.dynamic-mode:hover .mode-tab-close,
    .mode-tab.dynamic-mode:focus-within .mode-tab-close {
      opacity: 1;
    }
    .mode-tab:focus-visible { outline: 2px solid color-mix(in srgb, var(--primary) 45%, transparent); outline-offset: 2px; }
    .mode-switch-editor {
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      gap: .25rem;
      row-gap: .25rem;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: .25rem;
      box-shadow: var(--shadow);
      margin-bottom: .75rem;
      min-width: 0;
      max-width: 100%;
    }
    .mode-switch-editor[hidden] { display: none !important; }
    .current-file { color: var(--muted); font-size: .85rem; margin-left: .5rem; display: flex; flex-direction: column; gap: .18rem; min-width: 0; }
    .current-file .cf-line-main { font-weight: 600; color: color-mix(in srgb, var(--text) 65%, transparent); font-size: .9rem; display: inline-flex; align-items: center; gap: .4rem; min-width: 0; }
    .current-file .cf-line-main .cf-path { overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .current-file .cf-line-meta { font-size: .78rem; color: color-mix(in srgb, var(--muted) 88%, transparent); display: inline-flex; gap: .35rem; flex-wrap: wrap; }
    .current-file .cf-draft { display: inline-flex; align-items: center; gap: .35rem; font-weight: 500; color: color-mix(in srgb, #2563eb 70%, var(--text)); }
    .current-file .cf-draft::before { content: ''; width: .45rem; height: .45rem; border-radius: 999px; background: #22c55e; box-shadow: 0 0 0 3px color-mix(in srgb, #22c55e 18%, transparent); }
    .current-file[data-draft-state="conflict"] .cf-draft { color: color-mix(in srgb, #ef4444 75%, var(--text)); }
    .current-file[data-draft-state="conflict"] .cf-draft::before { background: #ef4444; box-shadow: 0 0 0 3px color-mix(in srgb, #ef4444 26%, transparent); }
    .current-file[data-dirty="1"] .cf-draft::before { background: #f97316; box-shadow: 0 0 0 3px color-mix(in srgb, #f97316 26%, transparent); }
    .current-file[data-file-state="checking"] .cf-line-main { color: color-mix(in srgb, #2563eb 70%, var(--text)); }
    .current-file[data-file-state="existing"] .cf-line-main { color: color-mix(in srgb, #15803d 70%, var(--text)); }
    .current-file[data-file-state="missing"] .cf-line-main { color: color-mix(in srgb, #d97706 75%, var(--text)); }
    .current-file[data-file-state="error"] .cf-line-main { color: color-mix(in srgb, #dc2626 80%, var(--text)); }
    .current-file[data-dirty="1"] .cf-line-main { color: color-mix(in srgb, #f97316 78%, var(--text)); }
    /* Grouped list styles */
    /* Ensure main editor can use full width */
    .editor-main { min-width: 0; overflow: visible; position: relative; }
    .page-titlebar { display:flex; align-items:flex-end; justify-content:space-between; gap:.5rem; margin-bottom: .75rem; flex-wrap: wrap; }
    .editor-lang-switcher {
      display: inline-flex;
      flex-direction: row;
      align-items: center;
      gap: .5rem;
      min-width: 0;
      padding: .35rem .65rem;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 10px;
      box-shadow: var(--shadow);
      align-self: flex-start;
      margin-right: auto;
    }
    .editor-lang-switcher label {
      font-size: .7rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: .08em;
      color: color-mix(in srgb, var(--muted) 85%, transparent);
      white-space: nowrap;
    }
    .editor-lang-switcher select {
      appearance: none;
      border: 1px solid color-mix(in srgb, var(--border) 85%, transparent);
      background: color-mix(in srgb, var(--card) 94%, transparent);
      color: var(--text);
      border-radius: 8px;
      padding: .3rem .8rem;
      font-size: .9rem;
      line-height: 1.4;
      cursor: pointer;
      min-width: 120px;
    }
    .editor-lang-switcher select:focus-visible {
      outline: 2px solid color-mix(in srgb, var(--primary) 48%, transparent);
      outline-offset: 2px;
    }
    .page-titlebar h1 { font-size: 1.35rem; margin: 0; }
    /* GitHub connection status */
    .status-stack { display:flex; flex-direction:column; align-items:stretch; gap:.75rem; }
    .status-stack > * { width:100%; }
    .global-status {
      display:flex;
      flex-direction:column;
      align-items:flex-start;
      gap:.7rem;
      color: var(--muted);
      font-size:.92rem;
      --gs-arrow-color: color-mix(in srgb, var(--muted) 72%, transparent);
      --gs-arrow-thickness: 7px;
      --gs-arrow-node-size: 16px;
      --gs-arrow-flow-duration: 2.8s;
    }
    .global-status[data-state="err"] { border-color: color-mix(in srgb, #dc2626 32%, var(--border)); }
    .global-status[data-state="warn"] { border-color: color-mix(in srgb, #f59e0b 28%, var(--border)); }
    .global-status[data-dirty="1"] { border-color: color-mix(in srgb, #f97316 30%, var(--border)); }
    .global-status .gs-flow {
      display:grid;
      grid-template-columns: max-content minmax(160px, 1fr) max-content;
      align-items:stretch;
      justify-content:center;
      column-gap:0;
      width:100%;
      position:relative;
    }
    .global-status .gs-node {
      display:flex;
      flex-direction:column;
      align-items:flex-start;
      gap:.55rem;
      background: color-mix(in srgb, var(--card) 92%, transparent);
      border:1px solid color-mix(in srgb, var(--border) 80%, transparent);
      border-radius:16px;
      padding:.95rem 1rem;
      min-width:0;
      position:relative;
      z-index: var(--gs-node-z, 2);
      overflow:visible;
    }
    .global-status .gs-node-local:has(.gs-node-drafts.has-many:hover),
    .global-status .gs-node-local:has(.gs-node-drafts.has-many:focus-within) {
      --gs-node-z: var(--gs-drafts-overlay-z, 2147483647);
    }
    @media (min-width: 521px) {
      .global-status .gs-node-remote,
      .global-status .gs-arrow {
        align-self:center;
      }
    }
    .global-status .gs-node::after { content:''; position:absolute; inset:0; border-radius:inherit; pointer-events:none; transition: box-shadow .18s ease, border-color .18s ease; border:2px solid transparent; }
    .global-status .gs-node-header { display:flex; align-items:center; gap:.55rem; width:100%; }
    .global-status .gs-node-icon { width:24px; height:24px; flex:0 0 auto; color: color-mix(in srgb, var(--muted) 70%, transparent); }
    .global-status .gs-node-label { display:block; font-size:.82rem; font-weight:700; letter-spacing:.06em; text-transform:none; color: color-mix(in srgb, var(--muted) 70%, transparent); }
    .global-status .gs-node-state { font-size:.95rem; font-weight:600; color: color-mix(in srgb, var(--text) 86%, transparent); line-height:1.4; }
    .global-status .gs-repo { font-weight:600; color: color-mix(in srgb, var(--text) 86%, transparent); font-size:.92rem; line-height:1.4; }
    .global-status .gs-message {
      display:flex;
      align-items:center;
      gap:.45rem;
      font-size:.86rem;
      color: color-mix(in srgb, var(--muted) 88%, transparent);
      line-height:1.45;
    }
    .global-status .gs-message::before {
      content:'';
      width:.5rem;
      height:.5rem;
      border-radius:999px;
      background: color-mix(in srgb, var(--muted) 72%, transparent);
      box-shadow:0 0 0 3px color-mix(in srgb, var(--muted) 18%, transparent);
      flex:0 0 auto;
      transition:background-color .18s ease, box-shadow .18s ease, transform .18s ease;
      transform:scale(.92);
    }
    .global-status[data-state="ok"] .gs-message::before {
      background:#22c55e;
      box-shadow:0 0 0 3px color-mix(in srgb, #22c55e 28%, transparent);
      transform:scale(1);
    }
    .global-status[data-state="warn"] .gs-message::before {
      background:#f59e0b;
      box-shadow:0 0 0 3px color-mix(in srgb, #f59e0b 28%, transparent);
      transform:scale(1);
    }
    .global-status[data-state="err"] .gs-message::before {
      background:#ef4444;
      box-shadow:0 0 0 3px color-mix(in srgb, #ef4444 28%, transparent);
      transform:scale(1);
    }
    .global-status .gs-message:empty { display:none; }
    .global-status .gs-arrow {
      position:relative;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:0 2.6rem;
      width:100%;
      --gs-flow-start: translate3d(-130%, -50%, 0);
      --gs-flow-end: translate3d(130%, -50%, 0);
      color: var(--gs-arrow-color);
      isolation:isolate;
      z-index:1;
    }
    .global-status .gs-arrow::before,
    .global-status .gs-arrow::after {
      content:'';
      position:absolute;
      left:calc(var(--gs-arrow-node-size) * -0.5);
      right:calc(var(--gs-arrow-node-size) * -0.5);
      top:50%;
      height:var(--gs-arrow-thickness);
      border-radius:var(--gs-arrow-thickness);
      pointer-events:none;
    }
    .global-status .gs-arrow::before {
      transform:translateY(-50%);
      background: color-mix(in srgb, var(--gs-arrow-color) 82%, transparent);
      box-shadow:0 4px 14px rgba(15, 23, 42, 0.08);
      z-index:-1;
    }
    .global-status .gs-arrow::after {
      transform:var(--gs-flow-start);
      background-image: linear-gradient(90deg,
        color-mix(in srgb, var(--gs-arrow-color) 18%, var(--card) 78%) 0%,
        color-mix(in srgb, var(--gs-arrow-color) 68%, var(--card) 12%) 24%,
        color-mix(in srgb, var(--gs-arrow-color) 98%, black 8%) 50%,
        color-mix(in srgb, var(--gs-arrow-color) 68%, var(--card) 12%) 76%,
        color-mix(in srgb, var(--gs-arrow-color) 18%, var(--card) 78%) 100%);
      filter: drop-shadow(0 0 8px color-mix(in srgb, var(--gs-arrow-color) 46%, transparent));
      opacity:0;
      will-change: transform, opacity;
      z-index:1;
    }
    @keyframes gs-arrow-flow-pass {
      0% { transform: var(--gs-flow-start); opacity: 0; }
      12% { opacity: 1; }
      88% { opacity: 1; }
      100% { transform: var(--gs-flow-end); opacity: 0; }
    }
    .global-status .gs-arrow.is-pending::after {
      opacity:1;
      animation: gs-arrow-flow-pass var(--gs-arrow-flow-duration) linear infinite;
    }
    .global-status .gs-arrow-tail,
    .global-status .gs-arrow-head {
      display:none;
    }
    .global-status .gs-node::before {
      content:'';
      position:absolute;
      top:50%;
      width:var(--gs-arrow-node-size);
      height:var(--gs-arrow-node-size);
      border-radius:999px;
      border:2px solid var(--gs-arrow-color);
      background: color-mix(in srgb, var(--card) 92%, transparent);
      box-shadow:0 2px 8px rgba(15, 23, 42, 0.08);
      pointer-events:none;
      z-index:3;
    }
    .global-status .gs-node-local::before {
      left:100%;
      transform:translate(-50%, -50%);
    }
    .global-status .gs-node-remote::before {
      left:0;
      transform:translate(-50%, -50%);
    }
    .global-status .gs-arrow-bubble {
      position:relative;
      z-index:4;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:.25rem .75rem;
      border-radius:999px;
      font-size:.78rem;
      font-weight:600;
      letter-spacing:.04em;
      text-transform:uppercase;
      white-space:nowrap;
      color: color-mix(in srgb, var(--muted) 72%, transparent);
      background: color-mix(in srgb, var(--card) 92%, transparent);
      border:1px solid color-mix(in srgb, var(--border) 70%, transparent);
      box-shadow:0 6px 18px rgba(15, 23, 42, 0.08);
      cursor: pointer;
      user-select: none;
      transition: background-color .18s ease, color .18s ease, border-color .18s ease, box-shadow .18s ease;
    }
    .global-status .gs-arrow-bubble:hover:not(.is-busy) {
      color: color-mix(in srgb, var(--text) 84%, transparent);
      background: color-mix(in srgb, var(--card) 94%, var(--primary) 8%);
      border-color: color-mix(in srgb, var(--primary) 28%, var(--border));
      box-shadow:0 10px 22px rgba(15, 23, 42, 0.14);
    }
    .global-status .gs-arrow-bubble:focus-visible {
      outline: 2px solid color-mix(in srgb, var(--primary) 62%, transparent);
      outline-offset: 2px;
    }
    .global-status .gs-arrow-bubble.is-busy {
      cursor: progress;
      opacity: .75;
      box-shadow:0 4px 14px rgba(15, 23, 42, 0.12);
    }
    .global-status[data-dirty="1"] .gs-node-local::after { box-shadow:0 0 0 2px color-mix(in srgb, #f97316 26%, transparent); border-color:color-mix(in srgb, #f97316 44%, transparent); }
    .global-status[data-state="warn"] .gs-node-remote::after { box-shadow:0 0 0 2px color-mix(in srgb, #f59e0b 24%, transparent); border-color:color-mix(in srgb, #f59e0b 42%, transparent); }
    .global-status[data-state="err"] .gs-node-remote::after { box-shadow:0 0 0 2px color-mix(in srgb, #dc2626 26%, transparent); border-color:color-mix(in srgb, #dc2626 46%, transparent); }
    .global-status[data-state="ok"]:not([data-dirty="1"]) .gs-node-remote::after { box-shadow:0 0 0 2px color-mix(in srgb, #1f883d 22%, transparent); border-color:color-mix(in srgb, #1f883d 42%, transparent); }
    .global-status[data-dirty="1"] { --gs-arrow-color: color-mix(in srgb, #f97316 75%, var(--text) 10%); }
    .global-status[data-dirty="1"] .gs-arrow-bubble {
      color: color-mix(in srgb, #9a3412 70%, transparent);
      background: color-mix(in srgb, #fed7aa 55%, var(--card) 60%);
      border-color: color-mix(in srgb, #fb923c 40%, var(--border));
    }
    .global-status:not([data-dirty="1"]) { --gs-arrow-color: color-mix(in srgb, var(--muted) 72%, transparent); }
    .global-status[data-state="ok"]:not([data-dirty="1"]) .gs-arrow-bubble {
      color: color-mix(in srgb, #166534 74%, transparent);
      background: color-mix(in srgb, #dcfce7 60%, var(--card) 65%);
      border-color: color-mix(in srgb, #22c55e 32%, var(--border));
    }
    .global-status[data-state="warn"]:not([data-dirty="1"]) {
      --gs-arrow-color: color-mix(in srgb, #f59e0b 68%, var(--text) 10%);
    }
    .global-status[data-state="warn"]:not([data-dirty="1"]) .gs-arrow-bubble {
      color: color-mix(in srgb, #92400e 70%, transparent);
      background: color-mix(in srgb, #fef3c7 60%, var(--card) 68%);
      border-color: color-mix(in srgb, #f59e0b 38%, var(--border));
    }
    .global-status[data-state="err"]:not([data-dirty="1"]) {
      --gs-arrow-color: color-mix(in srgb, #ef4444 70%, var(--text) 12%);
    }
    .global-status[data-state="err"]:not([data-dirty="1"]) .gs-arrow-bubble {
      color: color-mix(in srgb, #991b1b 72%, transparent);
      background: color-mix(in srgb, #fee2e2 60%, var(--card) 65%);
      border-color: color-mix(in srgb, #f87171 42%, var(--border));
    }
    @media (max-width: 520px) {
      .global-status .gs-flow {
        display:flex;
        flex-direction:column;
        align-items:stretch;
        gap:.75rem;
      }
      .global-status .gs-arrow {
        padding:1.5rem 0 .5rem;
        --gs-flow-start: translate3d(-50%, -130%, 0);
        --gs-flow-end: translate3d(-50%, 130%, 0);
      }
      .global-status .gs-arrow::before,
      .global-status .gs-arrow::after {
        left:50%;
        right:auto;
        top:calc(var(--gs-arrow-node-size) * -0.5);
        bottom:calc(var(--gs-arrow-node-size) * -0.5);
        width:var(--gs-arrow-thickness);
        height:auto;
      }
      .global-status .gs-arrow::before {
        transform:translateX(-50%);
      }
      .global-status .gs-arrow::after {
        background-image: linear-gradient(180deg,
          color-mix(in srgb, var(--gs-arrow-color) 18%, var(--card) 78%) 0%,
          color-mix(in srgb, var(--gs-arrow-color) 68%, var(--card) 12%) 26%,
          color-mix(in srgb, var(--gs-arrow-color) 98%, black 8%) 50%,
          color-mix(in srgb, var(--gs-arrow-color) 68%, var(--card) 12%) 74%,
          color-mix(in srgb, var(--gs-arrow-color) 18%, var(--card) 78%) 100%);
      }
      .global-status .gs-node::before {
        left:50%;
        top:100%;
        transform:translate(-50%, -50%);
      }
      .global-status .gs-node-remote::before {
        top:0;
        transform:translate(-50%, -50%);
      }
      .global-status .gs-arrow-bubble {
        margin:.4rem auto 0;
      }
    }
    .gs-node-drafts {
      --gs-drafts-collapsed-height: 3.6rem;
      --gs-drafts-expanded-max: min(60vh, 420px);
      display:flex;
      flex-direction:column;
      gap:.3rem;
      width:100%;
      margin-top:.1rem;
      font-size:.88rem;
      color: color-mix(in srgb, var(--text) 82%, transparent);
      position:relative;
      isolation:isolate;
      z-index: var(--gs-drafts-base-z, 1);
    }
    .gs-node-drafts[hidden] { display:none !important; }
    .gs-node-drafts:focus { outline:none; }
    .gs-node-drafts:focus-visible {
      outline:2px solid color-mix(in srgb, var(--primary) 55%, transparent);
      outline-offset:4px;
    }
    .gs-node-drafts-collapsed {
      position:relative;
      z-index:1;
    }
    .gs-node-drafts-shell {
      padding:.35rem .5rem;
      border-radius:.85rem;
      border:1px solid color-mix(in srgb, var(--border) 78%, transparent);
      background: color-mix(in srgb, var(--card) 98%, transparent);
      box-shadow:0 2px 8px rgba(15, 23, 42, 0.06);
      height: var(--gs-drafts-collapsed-height);
      min-height: var(--gs-drafts-collapsed-height);
      overflow:hidden;
      transition:border-color .18s ease, box-shadow .18s ease;
    }
    .gs-node-drafts.has-many .gs-node-drafts-shell { cursor:pointer; }
    .gs-node-drafts-track,
    .gs-node-drafts-overlay {
      list-style:none;
      margin:0;
      padding:0;
      display:flex;
      flex-direction:column;
      gap:.18rem;
      width:100%;
    }
    .gs-node-drafts-track { will-change:transform; }
    .gs-node-drafts-overlay {
      max-height: var(--gs-drafts-expanded-max);
      overflow-y:auto;
      overscroll-behavior:contain;
      scrollbar-gutter:stable;
      scrollbar-width:thin;
    }
    .gs-node-drafts-flyout {
      position:absolute;
      top:0;
      left:0;
      width:100%;
      max-height: var(--gs-drafts-expanded-max);
      pointer-events:none;
      opacity:0;
      transform:translateY(-6px) scale(.98);
      transform-origin:top center;
      transition:opacity .16s ease, transform .16s ease;
      z-index:20;
    }
    .gs-node-drafts-flyout-card {
      padding:.35rem .5rem;
      border-radius:.9rem;
      border:1px solid color-mix(in srgb, var(--primary) 26%, var(--border));
      background: color-mix(in srgb, var(--card) 96%, white 4%);
      box-shadow:0 18px 36px rgba(15, 23, 42, 0.18);
      max-height:inherit;
      overflow:visible;
    }
    .gs-node-drafts.has-many:hover,
    .gs-node-drafts.has-many:focus-within {
      z-index: var(--gs-drafts-overlay-z, 2147483647);
    }
    .gs-node-drafts.has-many:hover .gs-node-drafts-shell,
    .gs-node-drafts.has-many:focus-within .gs-node-drafts-shell {
      border-color: color-mix(in srgb, var(--primary) 28%, var(--border));
      box-shadow:0 12px 28px rgba(15, 23, 42, 0.16);
    }
    .gs-node-drafts.has-many:hover .gs-node-drafts-flyout,
    .gs-node-drafts.has-many:focus-within .gs-node-drafts-flyout {
      opacity:1;
      pointer-events:auto;
      transform:translateY(0) scale(1);
    }
    .gs-node-drafts:not(.has-many) .gs-node-drafts-flyout { display:none; }
    @media (prefers-reduced-motion: reduce) {
      .gs-node-drafts-shell,
      .gs-node-drafts-flyout {
        transition:none;
      }
    }
    .gs-node-drafts .gs-node-drafts-item {
      display:flex;
      align-items:center;
      gap:.42rem;
      color: color-mix(in srgb, var(--text) 84%, transparent);
      line-height:1.25;
      position:relative;
      padding-left: calc(1.05rem + .125rem);
    }
    .gs-node-drafts .gs-node-drafts-item::before {
      content:'';
      position:absolute;
      left:.125rem;
      top:calc(50% - .24rem);
      width:.48rem;
      height:.48rem;
      border-radius:999px;
      background: color-mix(in srgb, var(--primary) 40%, var(--text) 25%);
      box-shadow:0 0 0 2px color-mix(in srgb, var(--primary) 10%, transparent);
    }
    .gs-node-drafts .gs-node-drafts-label {
      font-weight:600;
      color: color-mix(in srgb, var(--text) 90%, transparent);
      display:inline-flex;
      align-items:center;
      gap:.25rem;
      flex-wrap:wrap;
    }
    .gs-node-drafts .gs-node-drafts-hint {
      font-weight:500;
      color: color-mix(in srgb, var(--muted) 88%, transparent);
    }
    .toolbar {
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:.75rem;
      flex-wrap:wrap;
      padding:.4rem 0 .55rem;
      border-bottom:1px solid #d0d7de;
      position:sticky;
      top:0;
      z-index:120;
      background:color-mix(in srgb, var(--card) 96%, transparent);
    }
    .left-actions, .right-actions { display:flex; align-items:center; gap:.5rem; flex-wrap:wrap; }
    .btn-secondary { display:inline-flex; align-items:center; justify-content:center; gap:.35rem; background: var(--card); color: var(--text); border:1px solid var(--border); padding:.45rem .8rem; border-radius:8px; cursor:pointer; font-size:.93rem; height:2.25rem; line-height:1; text-decoration:none; }
    .btn-secondary.btn-compact { padding:.3rem .65rem; height:2rem; font-size:.85rem; font-weight:600; }
    .btn-secondary[hidden] { display:none !important; }
    .btn-secondary:hover { background: color-mix(in srgb, var(--text) 5%, var(--card)); }
    a.btn-secondary:visited { color: var(--text); }
    .btn-secondary.is-busy { opacity:.6; cursor:progress; pointer-events:none; }
    .editor-tools {
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:.65rem;
      flex-wrap:wrap;
      margin-bottom:.6rem;
      position:sticky;
      top:calc(var(--editor-toolbar-offset, 0px));
      z-index:110;
      background:color-mix(in srgb, var(--card) 96%, transparent);
      padding-top:.4rem;
      padding-bottom:.4rem;
    }
    .editor-tools-left, .editor-tools-right { display:flex; align-items:center; gap:.4rem; flex-wrap:wrap; }
    .editor-tool-btn { white-space:nowrap; }
    .editor-tool-btn[disabled] { opacity:.55; cursor:not-allowed; }
    .editor-card-popover { position:absolute; top:calc(100% + .5rem); right:0; min-width:260px; max-width:min(420px, calc(100vw - 2.5rem)); padding:.75rem; border-radius:.85rem; border:1px solid color-mix(in srgb, var(--border) 75%, var(--text) 12%); background:color-mix(in srgb, var(--card) 96%, transparent); box-shadow:0 0 0 1px color-mix(in srgb, var(--card) 82%, transparent), 0 12px 28px rgba(15, 23, 42, 0.16), 0 22px 46px rgba(15, 23, 42, 0.12); z-index:1200; opacity:0; transform:translate3d(0, -10px, 0) scale(.98); pointer-events:none; transition:opacity .36s var(--composer-inline-ease, cubic-bezier(0.16, 1, 0.3, 1)), transform .36s var(--composer-inline-ease, cubic-bezier(0.16, 1, 0.3, 1)); will-change:opacity, transform; }
    .editor-card-popover.is-visible { opacity:1; transform:translate3d(0, 0, 0) scale(1); pointer-events:auto; }
    .editor-card-popover.is-closing { pointer-events:none; }
    .card-picker-search input { width:100%; border-radius:.65rem; border:1px solid color-mix(in srgb, var(--border) 82%, transparent); background:color-mix(in srgb, var(--card) 96%, transparent); padding:.45rem .7rem; font-size:.92rem; color:var(--text); transition:border-color .18s ease, box-shadow .18s ease; }
    .card-picker-search input::placeholder { color:color-mix(in srgb, var(--muted) 78%, transparent); }
    .card-picker-search input:focus { outline:2px solid color-mix(in srgb, var(--primary) 60%, transparent); outline-offset:1px; border-color:color-mix(in srgb, var(--primary) 42%, var(--border)); box-shadow:0 0 0 2px color-mix(in srgb, var(--primary) 15%, transparent); }
    .card-picker-list { margin-top:.6rem; max-height:280px; overflow-y:auto; display:flex; flex-direction:column; gap:.35rem; }
    .card-picker-item { display:flex; flex-direction:column; align-items:flex-start; gap:.15rem; width:100%; padding:.45rem .55rem; border-radius:.65rem; border:1px solid transparent; background:transparent; color:var(--text); cursor:pointer; font-size:.92rem; text-align:left; transition:background .16s ease, border-color .16s ease; }
    .card-picker-item:hover, .card-picker-item:focus { background:color-mix(in srgb, var(--text) 6%, transparent); border-color:color-mix(in srgb, var(--primary) 35%, var(--border)); outline:none; }
    .card-picker-item-title { font-weight:600; }
    .card-picker-item-meta { font-size:.78rem; color:var(--muted); }
    .card-picker-empty { margin-top:.5rem; text-align:center; font-size:.85rem; color:var(--muted); }
    .composer-confirm-popover {
      position: absolute;
      inset: auto auto;
      min-width: 250px;
      max-width: min(320px, calc(100vw - 2.5rem));
      padding: .9rem 1rem;
      border-radius: .85rem;
      border: 1px solid color-mix(in srgb, var(--border) 82%, transparent);
      background: color-mix(in srgb, var(--card) 96%, transparent);
      box-shadow: var(--shadow), 0 20px 48px rgba(15, 23, 42, 0.18);
      z-index: 1400;
      opacity: 0;
      transform: translateY(-6px) scale(.98);
      transform-origin: top right;
      transition: opacity .18s ease, transform .18s ease;
      pointer-events: none;
      display: block;
    }
    .composer-confirm-popover[data-placement="top"] { transform-origin: bottom right; }
    .composer-confirm-popover.is-visible {
      opacity: 1;
      transform: translateY(0) scale(1);
      pointer-events: auto;
    }
    .composer-confirm-message {
      font-size: .95rem;
      line-height: 1.45;
      color: var(--text);
      letter-spacing: .01em;
    }
    .composer-key-form {
      margin-top: .75rem;
      display: flex;
      flex-direction: column;
      gap: .45rem;
    }
    .composer-key-input {
      border-radius: .65rem;
      border: 1px solid color-mix(in srgb, var(--border) 85%, transparent);
      background: color-mix(in srgb, var(--card) 96%, transparent);
      padding: .5rem .7rem;
      font-size: .95rem;
      color: var(--text);
      width: 100%;
      transition: border-color .18s ease, background .18s ease, box-shadow .18s ease;
    }
    .composer-key-input::placeholder {
      color: color-mix(in srgb, var(--muted) 70%, var(--text));
    }
    .composer-key-input:focus {
      outline: 2px solid color-mix(in srgb, var(--primary) 60%, transparent);
      outline-offset: 1px;
      border-color: color-mix(in srgb, var(--primary) 45%, var(--border));
      background: color-mix(in srgb, var(--card) 94%, transparent);
      box-shadow: 0 0 0 2px color-mix(in srgb, var(--primary) 18%, transparent);
    }
    .composer-key-input[aria-invalid="true"] {
      border-color: color-mix(in srgb, #dc2626 60%, var(--border));
      background: color-mix(in srgb, #fee2e2 45%, var(--card));
    }
    .composer-key-hint {
      font-size: .78rem;
      color: var(--muted);
    }
    .composer-key-error {
      font-size: .78rem;
      color: #dc2626;
      min-height: 1em;
    }
    .composer-key-error:empty {
      display: none;
    }
    .composer-confirm-actions {
      margin-top: .85rem;
      display: flex;
      justify-content: flex-end;
      align-items: center;
      gap: .5rem;
      flex-wrap: wrap;
    }
    .composer-confirm-actions .btn-secondary {
      min-width: 4.25rem;
      padding-inline: .95rem;
      font-weight: 600;
      height: 2.25rem;
    }
    .composer-confirm-cancel { color: var(--muted); }
    .composer-confirm-cancel:hover { color: var(--text); }
    .composer-confirm-confirm {
      background: linear-gradient(135deg, color-mix(in srgb, var(--primary) 28%, var(--card)), color-mix(in srgb, var(--primary) 88%, var(--card)));
      color: #fff;
      border-color: color-mix(in srgb, var(--primary) 60%, var(--border));
      box-shadow: 0 14px 28px rgba(37, 99, 235, 0.2);
    }
    .composer-confirm-confirm:hover {
      background: linear-gradient(135deg, color-mix(in srgb, var(--primary) 36%, var(--card)), color-mix(in srgb, var(--primary) 98%, var(--card)));
    }
    .composer-confirm-confirm:focus-visible {
      outline: 2px solid color-mix(in srgb, var(--primary) 65%, transparent);
      outline-offset: 2px;
    }
    .composer-confirm-popover[data-placement="top"] .composer-confirm-actions { flex-direction: row-reverse; }
    @media (max-width: 640px) {
      .composer-confirm-popover { min-width: min(240px, calc(100vw - 2.5rem)); }
    }
    .site-footer {
      flex: 0 0 auto;
      margin: clamp(2rem, 5vw, 3rem) auto 0;
      padding: 1.5rem 1rem 2rem;
      width: min(95vw, 1200px);
      border-top: 1px solid color-mix(in srgb, var(--border) 92%, transparent);
      color: color-mix(in srgb, var(--muted) 90%, transparent);
      font-size: .9rem;
      text-align: center;
    }
    .site-footer a {
      color: inherit;
      text-decoration: none;
      font-weight: 600;
    }
    .site-footer a:hover {
      color: var(--primary);
      text-decoration: underline;
    }
    #btnDraft.is-dirty { border-color: color-mix(in srgb, #f97316 45%, var(--border)); background: color-mix(in srgb, #f97316 12%, var(--card)); color: color-mix(in srgb, #7c2d12 85%, transparent); }
    #btnDraft.is-clean { border-color: color-mix(in srgb, #16a34a 45%, var(--border)); background: color-mix(in srgb, #16a34a 10%, var(--card)); color: color-mix(in srgb, #14532d 85%, transparent); position: relative; }
    #btnDraft.is-clean::after { content: '✓'; position: absolute; top: -0.45rem; right: -0.45rem; font-size: .72rem; color: #15803d; background: var(--card); border: 1px solid color-mix(in srgb, #16a34a 55%, var(--border)); border-radius: 999px; width: 1.1rem; height: 1.1rem; display: inline-flex; align-items:center; justify-content:center; }
    #btnDraft.is-stale { position: relative; }
    #btnDraft.is-stale::after { content: '\26A0'; position: absolute; top: -0.45rem; right: -0.45rem; font-size: .72rem; color: #dc2626; background: var(--card); border: 1px solid color-mix(in srgb, #dc2626 55%, var(--border)); border-radius: 999px; width: 1.1rem; height: 1.1rem; display: inline-flex; align-items:center; justify-content:center; }
    button#btnDiscard.btn-secondary {
      background:#e15b5b !important;
      color:#3f1010 !important;
      border:1px solid #c94848 !important;
    }
    button#btnDiscard.btn-secondary:hover { background:#d14b4b !important; }
    button#btnDiscard.btn-secondary:active { background:#b73d3d !important; }
    button#btnDiscard.btn-secondary:focus-visible { outline:2px solid #f59f9f66; outline-offset:2px; }
    button#btnDiscardMarkdown.btn-secondary {
      background:#e15b5b !important;
      color:#3f1010 !important;
      border:1px solid #c94848 !important;
    }
    button#btnDiscardMarkdown.btn-secondary:hover { background:#d14b4b !important; }
    button#btnDiscardMarkdown.btn-secondary:active { background:#b73d3d !important; }
    button#btnDiscardMarkdown.btn-secondary:focus-visible { outline:2px solid #f59f9f66; outline-offset:2px; }
    button#btnDiscardMarkdown.btn-secondary:disabled {
      opacity:.55;
      cursor:not-allowed;
    }
    button#btnReview.btn-secondary {
      background:#f3c766 !important;
      color:#4a3510 !important;
      border:1px solid #e0ad3e !important;
    }
    button#btnReview.btn-secondary:hover { background:#e6b541 !important; }
    button#btnReview.btn-secondary:active { background:#cf9830 !important; }
    button#btnReview.btn-secondary:focus-visible { outline:2px solid #f7d98f66; outline-offset:2px; }
    .view-toggle,
    .wrap-toggle { display:inline-flex; align-items:center; gap:.35rem; font-size:.92rem; color:#57606a; }
    .view-toggle .vt-label,
    .wrap-toggle .vt-label { color:#6e7781; font-weight:500; margin-right:.25rem; }
    .view-toggle .vt-btn,
    .wrap-toggle .vt-btn { color:#0969da; text-decoration:none; padding:.1rem .25rem; border-radius:6px; position:relative; }
    .view-toggle .vt-btn:hover,
    .wrap-toggle .vt-btn:hover { text-decoration:underline; }
    .view-toggle .vt-btn.active,
    .wrap-toggle .vt-btn.active { background:#eaeef2; color:#24292f; text-decoration:none; cursor:default; }
    .view-toggle .vt-btn.has-draft::before { content:'●'; display:inline-block; font-size:.65rem; color:#f97316; margin-right:.35rem; line-height:1; }
    .view-toggle .vt-btn.has-draft { padding-left:.5rem; }
    .view-toggle .dim,
    .wrap-toggle .dim { color:#8c959f; }
    /* Editor: reuse SEO hi-editor rules for perfect alignment */
    .hi-editor pre.hi-pre { background-color: transparent; color: var(--code-text); padding: 1rem 1rem 1rem 0.5rem; overflow: hidden; border: 0; border-radius: 8px; line-height: 20px; font-size: 12px; tab-size: 4; position: relative; margin: 0; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Ubuntu Mono", monospace; font-weight: 400; font-variant-ligatures: none; letter-spacing: 0; }
    .hi-editor .code-scroll { display: flex; align-items: stretch; border: 1px solid var(--border); border-radius: 8px; background: var(--code-bg); overflow-x: auto; overflow-y: hidden; position: relative; }
    .hi-editor .code-scroll .code-gutter { flex: 0 0 auto; text-align: right; padding: 1rem 0.5rem; user-select: none; color: color-mix(in srgb, var(--code-text) 60%, transparent); border-right: 1px solid color-mix(in srgb, var(--code-text) 12%, transparent); margin-right: 0; background: var(--code-bg); position: sticky; left: 0; z-index: 1; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Ubuntu Mono", monospace; font-size: 12px; line-height: 20px; font-weight: 400; font-variant-ligatures: none; font-variant-numeric: tabular-nums; letter-spacing: 0; }
    .hi-editor .code-scroll .code-gutter span { display: block; line-height: inherit; font-variant-numeric: tabular-nums; }
    .hi-editor .code-scroll .code-gutter span.is-wrap-continued { color: color-mix(in srgb, var(--code-text) 38%, transparent); }
    .hi-editor { position: relative; }
    .hi-editor .hi-body { position: relative; flex: 1 1 auto; overflow: visible; }
    .hi-editor .hi-pre { position: absolute; inset: 0; margin: 0; white-space: pre; overflow: visible; pointer-events: none; }
    .hi-editor .hi-pre code { white-space: inherit; display: inline-block; min-width: 100%; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Ubuntu Mono", monospace; font-size: 12px; line-height: 20px; font-weight: 400; font-variant-ligatures: none; font-variant-numeric: tabular-nums; letter-spacing: 0; }
    .hi-editor .hi-ta { position: absolute; inset: 0; border: 0; outline: none; resize: none; background: transparent; color: transparent; caret-color: var(--code-text); padding: 1rem 1rem 1rem 0.5rem; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Ubuntu Mono", monospace; font-size: 12px; line-height: 20px; white-space: pre; overflow: hidden; overscroll-behavior: none; tab-size: 4; font-weight: 400; font-variant-ligatures: none; font-variant-numeric: tabular-nums; letter-spacing: 0; }
    .hi-editor.is-wrap .code-scroll { overflow-x: hidden; }
    .hi-editor.is-wrap .hi-pre,
    .hi-editor.is-wrap .hi-pre code,
    .hi-editor.is-wrap .hi-ta { white-space: pre-wrap; word-break: break-word; }
    .hi-editor.is-wrap .hi-pre code { min-width: 0; width: 100%; }
    .hi-editor .hi-hl-layer { position: absolute; inset: 0; z-index: 0; }
    .hi-editor .hi-hl-line { position: absolute; left: 0; right: 0; background: rgba(9,105,218,0.08); border-radius: 2px; box-shadow: inset 0 0 0 1px rgba(9,105,218,0.35); }
    .hi-editor .code-scroll .code-gutter span.is-active { background: transparent; color: #0f172a; font-weight: 600; }
    .syntax-language-label { position: absolute; top: .5rem; right: .75rem; background: rgba(0,0,0,.6); color: rgba(255,255,255,.9); padding: .25rem .5rem; border-radius: .25rem; font-size: .75rem; font-weight: 500; opacity: .8; border: 1px solid rgba(255,255,255,.1); cursor: pointer; user-select: none; line-height: 1; }

    @media (max-width: 640px) {
      .editor-page { padding: .75rem; }
    }

    .composer-panels { min-width: 0; display: grid; gap: 1.25rem; opacity: 1; transition: opacity 200ms ease; }
    .composer-panels.is-transitioning { pointer-events: none; }
    .composer-panels.is-hidden { opacity: 0; }
    .composer-order-host {
      position: relative;
      display: grid;
      grid-template-columns: clamp(150px, 24%, 220px) minmax(0, 1fr);
      grid-template-rows: minmax(0, 1fr);
      grid-template-areas: "inline main";
      column-gap: clamp(2rem, 5vw, 3.2rem);
      align-items: start;
      min-width: 0;
      transition: grid-template-columns var(--composer-inline-duration-in) var(--composer-inline-ease), column-gap var(--composer-inline-duration-in) var(--composer-inline-ease);
      will-change: grid-template-columns, column-gap;
    }
    .composer-order-host .composer-order-main { grid-area: main; position: relative; z-index: 2; min-width: 0; }
    .composer-order-inline { grid-area: inline; display: flex; flex-direction: column; gap: .6rem; position: relative; z-index: 2; min-height: 0; }
    .composer-order-inline[hidden] { display: none !important; }
    .composer-order-inline-meta { display: flex; flex-wrap: wrap; align-items: center; justify-content: space-between; gap: .6rem; margin: .75rem 0 .4rem; }
    .composer-order-inline-meta[hidden] { display: none !important; }
    .composer-order-inline,
    .composer-order-inline-meta {
      transform-origin: top left;
      will-change: opacity, transform;
    }
    .composer-order-inline[data-anim-state],
    .composer-order-inline-meta[data-anim-state] {
      animation-timing-function: var(--composer-inline-ease);
      animation-fill-mode: both;
    }
    .composer-order-inline[data-anim-state="enter"],
    .composer-order-inline-meta[data-anim-state="enter"] {
      animation-name: composerInlineEnter;
      animation-duration: var(--composer-inline-duration-in);
    }
    .composer-order-inline[data-anim-state="exit"],
    .composer-order-inline-meta[data-anim-state="exit"] {
      animation-name: composerInlineExit;
      animation-duration: var(--composer-inline-duration-out);
    }
    @keyframes composerInlineEnter {
      from { opacity: 0; transform: translateY(12px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes composerInlineExit {
      from { opacity: 1; transform: translateY(0); }
      to { opacity: 0; transform: translateY(-10px); }
    }
    .composer-order-inline-meta-head { display: flex; flex-wrap: wrap; align-items: center; gap: .6rem; }
    .composer-order-inline-titles { display: flex; flex-direction: column; gap: .15rem; min-width: 0; }
    .composer-order-inline-title { margin: 0; font-size: .96rem; font-weight: 700; color: var(--text); }
    .composer-order-inline-kind { font-size: .76rem; text-transform: uppercase; letter-spacing: .08em; color: color-mix(in srgb, var(--text) 58%, transparent); }
    .composer-order-inline-stats { display: flex; flex-direction: column; gap: .4rem; font-size: .78rem; color: var(--muted); }
    .composer-inline-chip-row { display: flex; flex-wrap: wrap; gap: .35rem; }
    .composer-inline-chip {
      display: inline-flex;
      align-items: center;
      gap: .3rem;
      border-radius: 999px;
      padding: .18rem .55rem;
      border: 1px solid color-mix(in srgb, var(--text) 16%, var(--border));
      background: color-mix(in srgb, var(--text) 4%, var(--card));
      font-weight: 600;
      font-size: .72rem;
      color: color-mix(in srgb, var(--text) 70%, transparent);
    }
    .composer-inline-chip[data-variant="added"] { color: #166534; }
    .composer-inline-chip[data-variant="added"] { border-color: color-mix(in srgb, #16a34a 55%, var(--border)); background: color-mix(in srgb, #16a34a 12%, transparent); }
    .composer-inline-chip[data-variant="removed"] { color: #b91c1c; }
    .composer-inline-chip[data-variant="removed"] { border-color: color-mix(in srgb, #dc2626 55%, var(--border)); background: color-mix(in srgb, #dc2626 12%, transparent); }
    .composer-inline-chip[data-variant="modified"] { color: #1d4ed8; }
    .composer-inline-chip[data-variant="modified"] { border-color: color-mix(in srgb, #2563eb 55%, var(--border)); background: color-mix(in srgb, #2563eb 12%, transparent); }
    .composer-inline-chip[data-variant="order"] { color: #7c3aed; }
    .composer-inline-chip[data-variant="order"] { border-color: color-mix(in srgb, #7c3aed 55%, var(--border)); background: color-mix(in srgb, #7c3aed 14%, transparent); }
    .composer-inline-chip[data-variant="langs"] { color: color-mix(in srgb, var(--text) 60%, transparent); }
    .composer-inline-summary-empty { font-size: .78rem; color: var(--muted); }
    .composer-order-inline-body { display: flex; flex-direction: column; }
    .composer-order-inline-list { display: block; position: relative; z-index: 2; }
    #ciList {
      position: relative;
      transform-origin: top left;
      will-change: transform;
    }
    .composer-order-inline-empty { font-size: .85rem; color: var(--muted); border: 1px dashed color-mix(in srgb, var(--border) 85%, transparent); border-radius: 8px; padding: .75rem; text-align: center; }
    .composer-order-inline-lines { position: absolute; inset: 0; pointer-events: none; z-index: 1; opacity: 0; transition: opacity .18s ease; }
    .composer-order-inline-lines.is-hovering { opacity: 1; }
    .composer-order-host[data-inline-active="false"] { grid-template-columns: minmax(0, 1fr); grid-template-areas: "main"; column-gap: 0; }
    .composer-order-host[data-inline-active="false"] .composer-order-inline-lines { display: none; }
    @media (prefers-reduced-motion: reduce) {
      .composer-order-inline[data-anim-state],
      .composer-order-inline-meta[data-anim-state] {
        animation: none !important;
      }
      .composer-order-host {
        transition: none !important;
      }
      #ciList {
        transition: none !important;
        animation: none !important;
        will-change: auto;
      }
    }
    .composer-order-inline .composer-order-item {
      margin: .5rem 0;
      min-height: 2.5rem;
      display: flex;
      align-items: center;
    }
    .composer-order-inline .composer-order-inline-item {
      overflow: hidden;
      height: auto;
      transition: height .28s ease, margin .28s ease;
      will-change: height, margin;
    }
    .composer-order-inline .composer-order-index { min-width: 1.7rem; font-size: .78rem; }
    .composer-order-inline .composer-order-key {
      font-size: .84rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      word-break: normal;
    }
    .composer-order-inline .composer-order-badge {
      font-size: .7rem;
      white-space: nowrap;
    }
    @media (max-width: 900px) {
      .composer-panels { gap: 1rem; }
      .composer-order-host {
        grid-template-columns: minmax(0, 1fr);
        grid-template-rows: auto minmax(0, 1fr);
        grid-template-areas:
          "inline"
          "main";
        column-gap: 0;
      }
      .composer-order-inline-lines { display: none; }
    }

    /* Back-to-top button */
    .back-to-top { position: fixed; right: 1rem; bottom: 1rem; width: 2.5rem; height: 2.5rem; border-radius: 999px; border: 1px solid var(--border); background: var(--card); color: var(--text); display: inline-flex; align-items: center; justify-content: center; box-shadow: var(--shadow); cursor: pointer; opacity: 0; transform: translateY(8px); pointer-events: none; transition: opacity .18s ease, transform .18s ease, background-color .18s ease; z-index: 999; }
    .back-to-top:hover { background: color-mix(in srgb, var(--text) 4%, var(--card)); }
    .back-to-top svg { width: 1.15rem; height: 1.15rem; }
    .back-to-top.show { opacity: .96; transform: translateY(0); pointer-events: auto; }

    /* Full-screen overlay used while waiting for GitHub sync */
    .sync-overlay { position: fixed; inset: 0; display: none; align-items: center; justify-content: center; padding: 1rem; background: color-mix(in srgb, rgba(15,23,42,0.62) 88%, transparent); backdrop-filter: blur(6px); z-index: 14000; }
    .sync-overlay.is-visible { display: flex; }
    body.ns-sync-overlay-open { overflow: hidden; }
    .sync-overlay-panel { background: color-mix(in srgb, var(--card) 96%, transparent); border: 1px solid color-mix(in srgb, var(--border) 82%, transparent); border-radius: 16px; padding: 2rem 2.5rem; max-width: min(520px, 100%); box-shadow: 0 24px 64px rgba(15, 23, 42, 0.28); display: flex; flex-direction: column; align-items: center; gap: 1.1rem; text-align: center; position: relative; }
    .sync-overlay-spinner { width: 52px; height: 52px; border-radius: 50%; border: 4px solid color-mix(in srgb, var(--primary) 22%, transparent); border-top-color: var(--primary); animation: sync-overlay-spin .85s linear infinite; }
    .sync-overlay-title { margin: 0; font-size: 1.35rem; font-weight: 700; color: var(--text); }
    .sync-overlay-message { margin: 0; color: color-mix(in srgb, var(--muted) 92%, transparent); font-size: .98rem; line-height: 1.5; }
    .sync-overlay-status { margin: 0; color: color-mix(in srgb, var(--text) 82%, transparent); font-size: 1rem; font-weight: 600; min-height: 1.35em; }
    .sync-overlay-cancel { margin-top: .25rem; min-width: 8.5rem; }
    .sync-overlay-cancel[hidden] { display: none !important; }
    @media (max-width: 640px) {
      .sync-overlay-panel { padding: 1.6rem 1.4rem; }
    }
    @keyframes sync-overlay-spin { to { transform: rotate(360deg); } }

    /* Preload-state CSS to avoid flash when initial mode is Composer */
    [data-init-mode="composer"] #mode-editor { display: none !important; }
    [data-init-mode="composer"] #mode-composer { display: block !important; }
    [data-init-mode="composer"] .mode-tab[data-mode="composer"] {
      background: color-mix(in srgb, var(--primary) 14%, var(--card));
      border-color: color-mix(in srgb, var(--primary) 38%, var(--border));
      color: var(--primary);
      cursor: default;
    }
    /* Preselect composer sub-file to tabs when persisted */
    [data-init-cfile="tabs"] #composerIndex { display: none !important; }
    [data-init-cfile="tabs"] #composerTabs { display: block !important; }
    [data-init-cfile="site"] #composerSite { display: block !important; }
    [data-init-cfile="site"] #composerIndex,
    [data-init-cfile="site"] #composerTabs { display: none !important; }
  </style>
</head>
<body>
  <div class="editor-page">
    <div class="page-titlebar">
      <div class="editor-lang-switcher" id="editorLangSwitcher">
        <label for="editorLangSelect" data-i18n="editor.languageLabel">Language</label>
        <select id="editorLangSelect" data-i18n-aria-label="editor.languageLabel"></select>
      </div>
      <nav class="mode-switch" role="tablist" aria-label="Mode switch" data-i18n-aria-label="editor.nav.modeSwitchAria">
        <button class="mode-tab is-active" data-mode="composer" data-tab-label="Composer" data-i18n-data-tab-label="editor.modes.composer" role="tab" aria-controls="mode-composer" aria-selected="true" aria-label="Composer" data-i18n-aria-label="editor.modes.composer">
          <span class="mode-tab-text" data-i18n="editor.modes.composer">Composer</span>
          <span class="mode-tab-badge" aria-hidden="true" hidden></span>
        </button>
        <button class="mode-tab" data-mode="editor" data-tab-label="Editor" data-i18n-data-tab-label="editor.modes.editor" role="tab" aria-controls="mode-editor" aria-selected="false" aria-label="Editor" data-i18n-aria-label="editor.modes.editor">
          <span class="mode-tab-text" data-i18n="editor.modes.editor">Editor</span>
          <span class="mode-tab-badge" aria-hidden="true" hidden></span>
        </button>
        <button class="mode-tab" data-mode="updates" data-tab-label="System Updates" data-i18n-data-tab-label="editor.systemUpdates.tabLabel" role="tab" aria-controls="mode-updates" aria-selected="false" aria-label="System Updates" data-i18n-aria-label="editor.systemUpdates.tabLabel">
          <span class="mode-tab-text" data-i18n="editor.systemUpdates.tabLabel">System Updates</span>
          <span class="mode-tab-badge" aria-hidden="true" hidden></span>
        </button>
      </nav>
      <div class="status-stack">
        <div id="global-status" class="global-status" aria-live="polite">
          <div class="gs-flow">
            <div class="gs-node gs-node-local">
              <div class="gs-node-header">
                <span class="gs-node-icon" aria-hidden="true">
                  <svg width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M4.75 4h14.5A1.75 1.75 0 0 1 21 5.75v8.5A1.75 1.75 0 0 1 19.25 16H4.75A1.75 1.75 0 0 1 3 14.25v-8.5A1.75 1.75 0 0 1 4.75 4Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M7 20h10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M9 16v1.25A1.75 1.75 0 0 0 10.75 19h2.5A1.75 1.75 0 0 0 15 17.25V16" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </span>
                <span class="gs-node-label" data-i18n="editor.status.localLabel">LOCAL</span>
              </div>
              <span class="gs-node-state" id="globalLocalState" data-i18n="editor.status.checkingDrafts">Checking drafts…</span>
              <div id="localDraftSummary" class="gs-node-drafts" hidden aria-live="polite"></div>
            </div>
            <span class="gs-arrow" aria-hidden="true">
              <span class="gs-arrow-tail"></span>
              <span class="gs-arrow-bubble" id="globalArrowLabel" data-i18n="editor.status.synced">Synced</span>
              <span class="gs-arrow-head"></span>
            </span>
            <div class="gs-node gs-node-remote">
              <div class="gs-node-header">
                <span class="gs-node-icon" aria-hidden="true">
                  <svg width="22" height="22" viewBox="0 0 98 96" xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M48.854 0C21.839 0 0 22 0 49.217c0 21.756 13.993 40.172 33.405 46.69 2.427.49 3.316-1.059 3.316-2.362 0-1.141-.08-5.052-.08-9.127-13.59 2.934-16.42-5.867-16.42-5.867-2.184-5.704-5.42-7.17-5.42-7.17-4.448-3.015.324-3.015.324-3.015 4.934.326 7.523 5.052 7.523 5.052 4.367 7.496 11.404 5.378 14.235 4.074.404-3.178 1.699-5.378 3.074-6.6-10.839-1.141-22.243-5.378-22.243-24.283 0-5.378 1.94-9.778 5.014-13.2-.485-1.222-2.184-6.275.486-13.038 0 0 4.125-1.304 13.426 5.052a46.97 46.97 0 0 1 12.214-1.63c4.125 0 8.33.571 12.213 1.63 9.302-6.356 13.427-5.052 13.427-5.052 2.67 6.763.97 11.816.485 13.038 3.155 3.422 5.015 7.822 5.015 13.2 0 18.905-11.404 23.06-22.324 24.283 1.78 1.548 3.316 4.481 3.316 9.126 0 6.6-.08 11.897-.08 13.526 0 1.304.89 2.853 3.316 2.364 19.412-6.52 33.405-24.935 33.405-46.691C97.707 22 75.788 0 48.854 0z" fill="currentColor"/>
                  </svg>
                </span>
                <span class="gs-node-label" data-i18n="editor.status.remoteLabel">GitHub</span>
              </div>
              <span class="gs-repo" id="globalStatusRepo" data-i18n="editor.status.loadingRepo">Loading GitHub settings…</span>
              <span class="gs-message" id="globalStatusMessage" data-i18n="editor.status.checkingConnection">Checking connection…</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Editor Mode -->
    <div class="editor-layout is-empty" id="mode-editor">
      <section class="box editor-main">
        <nav class="mode-switch-editor" id="modeDynamicTabs" role="tablist" aria-label="Open editor tabs" data-i18n-aria-label="editor.nav.dynamicTabsAria" hidden aria-hidden="true"></nav>
        <div class="toolbar">
          <div class="left-actions">
            <span class="current-file" id="currentFile" aria-live="polite"></span>
          </div>
          <div class="right-actions">
            <div class="wrap-toggle view-toggle" id="wrapToggle" aria-label="Wrap setting" data-i18n-aria-label="editor.toolbar.wrapAria">
              <span class="vt-label" data-i18n="editor.toolbar.wrap">Wrap:</span>
              <a href="#" class="vt-btn" data-wrap="on" role="button" data-i18n="editor.toolbar.wrapOn">on</a>
              <span class="dim" aria-hidden="true">/</span>
              <a href="#" class="vt-btn active" data-wrap="off" role="button" data-i18n="editor.toolbar.wrapOff">off</a>
            </div>
            <div class="view-toggle" aria-label="View switch" data-i18n-aria-label="editor.toolbar.viewAria">
              <span class="vt-label" data-i18n="editor.toolbar.view">View:</span>
              <a href="#" class="vt-btn active" data-view="edit" data-i18n="editor.toolbar.viewEdit">Editor</a>
              <span class="dim" aria-hidden="true">/</span>
              <a href="#" class="vt-btn" data-view="preview" data-i18n="editor.toolbar.viewPreview">Preview</a>
            </div>
            <button type="button" class="btn-secondary" id="btnDiscardMarkdown" disabled>
              <span class="btn-label" data-i18n="editor.toolbar.discard">Discard</span>
            </button>
          </div>
        </div>

        <div class="editor-tools" id="editorToolbar" aria-label="Editor tools" data-i18n-aria-label="editor.editorTools.aria">
          <div class="editor-tools-left" role="group" aria-label="Formatting shortcuts" data-i18n-aria-label="editor.editorTools.formatGroupAria">
            <button type="button" class="btn-secondary btn-compact editor-tool-btn" id="btnFmtBold" title="Bold" aria-label="Bold" disabled data-i18n="editor.editorTools.bold" data-i18n-title="editor.editorTools.bold" data-i18n-aria-label="editor.editorTools.bold">Bold</button>
            <button type="button" class="btn-secondary btn-compact editor-tool-btn" id="btnFmtItalic" title="Italic" aria-label="Italic" disabled data-i18n="editor.editorTools.italic" data-i18n-title="editor.editorTools.italic" data-i18n-aria-label="editor.editorTools.italic">Italic</button>
            <button type="button" class="btn-secondary btn-compact editor-tool-btn" id="btnFmtStrike" title="Strikethrough" aria-label="Strikethrough" disabled data-i18n="editor.editorTools.strike" data-i18n-title="editor.editorTools.strike" data-i18n-aria-label="editor.editorTools.strike">Strike</button>
            <button type="button" class="btn-secondary btn-compact editor-tool-btn" id="btnFmtHeading" title="Heading" aria-label="Heading" disabled data-i18n="editor.editorTools.heading" data-i18n-title="editor.editorTools.heading" data-i18n-aria-label="editor.editorTools.heading">Heading</button>
            <button type="button" class="btn-secondary btn-compact editor-tool-btn" id="btnFmtQuote" title="Quote" aria-label="Quote" disabled data-i18n="editor.editorTools.quote" data-i18n-title="editor.editorTools.quote" data-i18n-aria-label="editor.editorTools.quote">Quote</button>
            <button type="button" class="btn-secondary btn-compact editor-tool-btn" id="btnFmtCode" title="Inline code" aria-label="Inline code" disabled data-i18n="editor.editorTools.code" data-i18n-title="editor.editorTools.code" data-i18n-aria-label="editor.editorTools.code">Code</button>
            <button type="button" class="btn-secondary btn-compact editor-tool-btn" id="btnFmtCodeBlock" title="Code block" aria-label="Code block" disabled data-i18n="editor.editorTools.codeBlock" data-i18n-title="editor.editorTools.codeBlock" data-i18n-aria-label="editor.editorTools.codeBlock">Code Block</button>
          </div>
          <div class="editor-tools-right">
            <button type="button" class="btn-secondary btn-compact editor-tool-btn" id="btnInsertCard" title="Insert article card" aria-haspopup="dialog" aria-expanded="false" data-i18n="editor.editorTools.articleCard" data-i18n-title="editor.editorTools.insertCardTitle">Article Card</button>
            <button type="button" class="btn-secondary btn-compact editor-tool-btn" id="btnInsertImage">
              <span class="btn-label" data-i18n="editor.editorTools.insertImage">Insert Image</span>
            </button>
            <input type="file" id="editorImageInput" accept="image/*" multiple hidden>
          </div>
          <div class="editor-card-popover" id="editorCardPicker" hidden aria-hidden="true" role="dialog" aria-label="Insert article card" data-i18n-aria-label="editor.editorTools.cardDialogAria">
            <div class="card-picker-search">
              <input type="search" id="cardPickerSearch" placeholder="Search articles…" aria-label="Search articles" data-i18n-placeholder="editor.editorTools.cardSearch" data-i18n-aria-label="editor.editorTools.cardSearch">
            </div>
            <div class="card-picker-list" id="cardPickerList" role="listbox"></div>
            <div class="card-picker-empty" id="cardPickerEmpty" hidden data-i18n="editor.editorTools.cardEmpty">No matching articles</div>
          </div>
        </div>

        <div id="editor-wrap">
          <textarea id="mdInput" placeholder="# Hello NanoSite\n\nStart typing Markdown…" aria-label="Markdown source" data-i18n-placeholder="editor.editorPlaceholder" data-i18n-aria-label="editor.editorTextareaAria"></textarea>
        </div>

        <div id="preview-wrap" style="display:none;">
          <!-- Reuse site post styles by using #mainview as container -->
          <div id="mainview"></div>
        </div>
      </section>

      <div class="editor-empty-state" id="editorEmptyState" role="status" aria-live="polite">
        <div class="empty-body">
          <h2 data-i18n="editor.empty.title">No editor is currently open</h2>
          <p data-i18n="editor.empty.body">Open Markdown from the Composer to start editing.</p>
        </div>
      </div>
    </div>

    <!-- Composer Mode -->
    <div class="editor-layout" id="mode-composer" style="display:none;">
      <section class="box editor-main" style="grid-column: 1 / -1;">
        <div class="toolbar">
          <div class="left-actions">
            <div class="view-toggle" aria-label="File switch" data-i18n-aria-label="editor.composer.fileSwitchAria">
              <span class="vt-label" data-i18n="editor.composer.fileLabel">File:</span>
              <a href="#" class="vt-btn active" data-cfile="index" data-i18n="editor.composer.fileArticles">Articles</a>
              <span class="dim" aria-hidden="true">/</span>
              <a href="#" class="vt-btn" data-cfile="tabs" data-i18n="editor.composer.filePages">Pages</a>
              <span class="dim" aria-hidden="true">/</span>
              <a href="#" class="vt-btn" data-cfile="site" data-i18n="editor.composer.fileSite">Site</a>
            </div>
          </div>
          <div class="right-actions">
            <button class="btn-secondary" id="btnAddItem" data-i18n="editor.composer.addPost">Add Post Entry</button>
            <button class="btn-secondary" id="btnRefresh" title="Fetch latest remote snapshot" data-i18n="editor.composer.refresh" data-i18n-title="editor.composer.refreshTitle">Refresh</button>

            <button class="btn-secondary" id="btnDiscard" title="Discard local draft and reload remote file" data-i18n="editor.composer.discard" data-i18n-title="editor.composer.discardTitle" hidden>Discard</button>
          </div>
        </div>
        <div class="composer-order-inline-meta" id="composerOrderInlineMeta" hidden>
          <div class="composer-order-inline-meta-head">
            <div class="composer-order-inline-titles">
              <h3 class="composer-order-inline-title" data-i18n="editor.composer.changeSummary">Change summary</h3>
              <span class="composer-order-inline-kind">index.yaml</span>
            </div>
            <button type="button" class="btn-secondary btn-compact composer-order-inline-open" data-kind="index" aria-label="Open change overview" data-i18n="editor.composer.reviewChanges" data-i18n-aria-label="editor.composer.reviewChanges">Review changes</button>
          </div>
          <div class="composer-order-inline-stats" aria-live="polite"></div>
        </div>

        <!-- Composer Lists -->
        <div class="composer-panels" id="composerPanels">
          <div class="composer-order-host" data-kind="index" data-inline-active="false" id="composerIndexHost">
            <div class="composer-order-inline" id="composerOrderInlineIndex" aria-label="Old order for index.yaml" data-i18n-aria-label="editor.composer.indexInlineAria" hidden>
              <div class="composer-order-inline-body">
                <div class="composer-order-inline-list" role="list"></div>
                <div class="composer-order-inline-empty" aria-hidden="false" data-i18n="editor.composer.inlineEmpty">No entries to compare yet.</div>
              </div>
            </div>
            <div class="composer-order-main">
              <div id="composerIndex" aria-label="index.yaml editor" data-i18n-aria-label="editor.composer.indexEditorAria" style="display:block;"></div>
            </div>
          </div>
          <div class="composer-order-host" data-kind="tabs" data-inline-active="false" id="composerTabsHost" style="display:none;">
            <div class="composer-order-inline" id="composerOrderInlineTabs" aria-label="Old order for tabs.yaml" data-i18n-aria-label="editor.composer.tabsInlineAria" hidden>
              <div class="composer-order-inline-body">
                <div class="composer-order-inline-list" role="list"></div>
                <div class="composer-order-inline-empty" aria-hidden="false" data-i18n="editor.composer.inlineEmpty">No entries to compare yet.</div>
              </div>
            </div>
            <div class="composer-order-main">
              <div id="composerTabs" aria-label="tabs.yaml editor" data-i18n-aria-label="editor.composer.tabsEditorAria" style="display:none;"></div>
            </div>
          </div>
          <div class="composer-site-host" id="composerSiteHost" style="display:none;">
            <div class="composer-site-main">
              <div id="composerSite" aria-label="site.yaml editor" data-i18n-aria-label="editor.composer.siteEditorAria" style="display:none;"></div>
            </div>
          </div>
        </div>

        <!-- YAML preview/export area -->
        <div id="yamlExportWrap" style="display:none; margin-top: .75rem;">
          <textarea id="yamlExport" style="width:100%; height: 280px; border:1px solid var(--border); border-radius:8px; background:var(--card); color:var(--text); padding:.6rem; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Ubuntu Mono', monospace; font-size: 12px; line-height: 18px;"></textarea>
        </div>
      </section>
    </div>
    <!-- System Updates Mode -->
    <div class="updates-layout" id="mode-updates" style="display:none;">
      <section class="box updates-main">
        <div class="updates-header">
          <div class="updates-header-text">
            <h2 class="updates-title" data-i18n="editor.systemUpdates.title">System Updates</h2>
            <div class="updates-meta">
              <span id="systemUpdateReleaseMeta"></span>
              <span id="systemUpdateReleasePublished"></span>
              <span id="systemUpdateAssetMeta" class="updates-asset"></span>
            </div>
          </div>
          <div class="updates-header-actions">
            <a class="btn-secondary updates-download" id="systemUpdateDownloadLink" href="#" target="_blank" rel="noopener" aria-disabled="true" data-i18n="editor.systemUpdates.openDownload">Open latest release</a>
            <button class="btn-primary" type="button" id="btnSystemSelect" data-i18n="editor.systemUpdates.selectArchive">Select downloaded ZIP</button>
            <input type="file" id="systemUpdateFileInput" accept=".zip,application/zip,application/x-zip-compressed" hidden>
          </div>
        </div>
        <p id="systemUpdateStatus" class="updates-status" data-tone="info"></p>
        <div id="systemUpdateFileSection" class="updates-files" hidden aria-hidden="true">
          <h3 class="updates-subtitle" data-i18n="editor.systemUpdates.filesHeading">Pending system files</h3>
          <ul id="systemUpdateFileList" class="updates-file-list"></ul>
        </div>
        <div class="updates-notes">
          <h3 class="updates-subtitle" data-i18n="editor.systemUpdates.releaseNotes">Release notes</h3>
          <div id="systemUpdateReleaseNotes" class="updates-release-notes"></div>
        </div>
      </section>
    </div>
  </div>

  <footer class="site-footer">
    <p data-i18n-html="editor.footerNote">Crafted with ❤️ using <a href="https://deemoe404.github.io/NanoSite/" target="_blank" rel="noopener">NanoSite</a>. Stay inspired and keep creating.</p>
  </footer>
  <script>
    (function () {
      const root = document.documentElement;
      const toolbarNodes = Array.from(document.querySelectorAll('.editor-main .toolbar'));
      if (!toolbarNodes.length) return;

      const updateOffset = () => {
        let maxOffset = 0;
        for (const toolbar of toolbarNodes) {
          if (!toolbar.isConnected) continue;
          if (toolbar.getClientRects().length === 0) continue;
          const height = toolbar.offsetHeight;
          if (height > 0) {
            maxOffset = Math.max(maxOffset, height);
          }
        }
        root.style.setProperty('--editor-toolbar-offset', `${maxOffset}px`);
      };

      if (typeof ResizeObserver !== 'undefined') {
        const ro = new ResizeObserver(updateOffset);
        toolbarNodes.forEach((toolbar) => ro.observe(toolbar));
      }

      const layouts = ['mode-editor', 'mode-composer']
        .map((id) => document.getElementById(id))
        .filter(Boolean);
      if (layouts.length) {
        const mo = new MutationObserver(updateOffset);
        layouts.forEach((node) => mo.observe(node, { attributes: true, attributeFilter: ['class', 'style'] }));
      }

      window.addEventListener('load', updateOffset, { once: true });
      updateOffset();
    })();
  </script>
  <script type="module" src="assets/js/editor-boot.js"></script>
  <script type="module" src="assets/js/editor-main.js"></script>
  <script type="module" src="assets/js/composer.js"></script>
  <script type="module" src="assets/js/editor-github.js"></script>
  <!-- Back to top button -->
  <button id="backToTop" class="back-to-top" aria-label="返回顶部" title="返回顶部" type="button" hidden>
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
      <polyline points="18 15 12 9 6 15"></polyline>
    </svg>
  </button>
</body>
</html>
